show_doorbell_alert:
  alias: Show doorbell alert
  description: "Show an alert on the TV if the doorbell rings"
  icon: mdi:doorbell
  mode: single
  max_exceeded: silent
  sequence:
    - condition:
        - "{{ states('media_player.tv_woonkamer') not in ['off','unavailable'] }}"
    - service: notify.tv_woonkamer
      continue_on_error: true
      data:
        title: Deurbel!
        message: Er staat iemand aan de deur
        data:
          fontsize: large
          position: top-right
          duration: 10
          transparency: 50%
          color: grey

send_doorbell_notification:
  alias: Send doorbell notification
  description: "Send a notification when the doorbell rings"
  icon: mdi:doorbell
  mode: restart
  variables:
    notification_service: >
      {% if is_state("device_tracker.sm_a336b", "home") and is_state("device_tracker.sm_a526b", "home") %}notify.mobile_devices_adults
      {% elif is_state("device_tracker.sm_a336b", "home") %}notify.mobile_app_sm_a336b
      {% elif is_state("device_tracker.sm_a526b", "home") %}notify.mobile_app_sm_a526b
      {% else %}notify.bogus
      {% endif %}
  sequence:
    - alias: Send doorbell notification
      service: "{{ notification_service }}"
      data:
        title: Knock Knock!
        message: Er staat iemand aan de deur!
        data:
          tag: deurbel
          ttl: 0
          channel: doorbell
          priority: high
          icon_url: "https://raw.githubusercontent.com/home-assistant/assets/master/logo/logo-pretty.png"
          # Instead of taking a camera snapshot first, just use the existing entity picture
          image: "{{state_attr('camera.voordeur', 'entity_picture')}}"
          # OnClick, go to the live camera view
          clickAction: "/lovelace/camera"
    - alias: Wait to see if front door opens
      wait_for_trigger:
        - platform: state
          entity_id: binary_sensor.door_sensor_2_contact
          to: "on"
      timeout: "00:01:00"
      continue_on_timeout: true
    - alias: Somebody answered the door, so clear the notification
      service: "{{ notification_service }}"
      data:
        message: clear_notification
        data:
          tag: deurbel
          ttl: 0
          channel: doorbell
          priority: high
