zonneplan_package:
  ##########################
  ## Dynamic energy prices
  ##########################
  template:
    - sensor:
        - name: "Zonneplan goedkoopste prijs"
          unique_id: zonneplan_cheapest_tariff
          state: >
            {% set cheapest = state_attr('sensor.zonneplan_current_electricity_tariff', 'forcast')
                        | selectattr('datetime', '>', utcnow().isoformat())
                        | sort(attribute='price')  
                        | first %}
            {{ (cheapest.price /10000000) | round(2) | float }}
          attributes:
            datetime: >
              {% set cheapest = state_attr('sensor.zonneplan_current_electricity_tariff', 'forcast')
                          | selectattr('datetime', '>', utcnow().isoformat())
                          | sort(attribute='price')  
                          | first %}
              {{ cheapest.datetime }}
          state_class: measurement
          unit_of_measurement: €/kWh

        - name: "Zonneplan duurste prijs"
          unique_id: zonneplan_most_expensive_tariff
          state: >
            {% set expensive = state_attr('sensor.zonneplan_current_electricity_tariff', 'forcast')
                        | selectattr('datetime', '>', utcnow().isoformat())
                        | sort(attribute='price', reverse = True)
                        | first %}
            {{ (expensive.price /10000000) | round(2) | float}}
          attributes:
            datetime: >
              {% set expensive = state_attr('sensor.zonneplan_current_electricity_tariff', 'forcast')
                          | selectattr('datetime', '>', utcnow().isoformat())
                          | sort(attribute='price', reverse = True)
                          | first %}
              {{ expensive.datetime }}
          state_class: measurement
          unit_of_measurement: €/kWh
