system_package:
  automation:
    ##########################
    ## Set theme
    ##########################
    - id: set_theme
      alias: "Stel thema in"
      triggers:
        - trigger: homeassistant
          event: start
        - trigger: numeric_state
          entity_id: sun.sun
          attribute: elevation
          above: 0
        - trigger: numeric_state
          entity_id: sun.sun
          attribute: elevation
          below: 0
      actions:
        - if: "{{ is_state('sun.sun', 'above_horizon')}}"
          then:
            - action: frontend.set_theme
              data:
                name: "Hmmbob light theme"
                mode: dark
          else:
            - action: frontend.set_theme
              data:
                name: "Hmmbob dark theme"
                mode: dark

    # Automation om de datum van het "eindveld" in de UI op dezelfde waarde in te stellen als de "startdatum"
    - id: ui_set_end_date
      alias: "Stel de datum van het eindveld op dezelfde dag in als de begindatum"
      description: "Systeem: Repareer de UI - stel datum van eindveld in op datum van begindatum"
      triggers:
        - trigger: state
          entity_id: input_datetime.solar_pv_off_start
          variables:
            end_entity_id: input_datetime.solar_pv_off_end
      actions:
        - alias: Stel datum van gewenst eindveld in
          action: input_datetime.set_datetime
          target:
            entity_id: "{{ end_entity_id }}"
          data:
            date: "{{states(trigger.entity_id) | truncate(10, 'False', '') }}"

    ##########################
    ## System update notifications
    ##########################
    - alias: "Stuur een melding dat er een nieuwe Home Assistant versie is"
      id: system_update_available_notification
      description: Stuur melding als Home Assistant update beschikbaar is
      triggers:
        - trigger: state
          entity_id: sensor.latest_version
          not_to:
            - "unknown"
            - "unavailable"
            - "none"
      conditions:
        - condition: template
          value_template: >
            {{ states('sensor.latest_version') != states('sensor.current_version') }}
      actions:
        - action: notify.mobile_app_sm_a556b
          data:
            title: Moment om op te graden!
            message: >
              Er is een upgrade voor de Home Assistant container in behandeling!
              Versie {{ states('sensor.latest_version') }} is zojuist uitgebracht!
            data:
              tag: System
              channel: System
              notification_icon: mdi:cellphone-arrow-down
              actions:
                - action: "URI"
                  title: "Wijzigingslogboek openen"
                  uri: "https://github.com/home-assistant/core/releases/tag/{{states('sensor.latest_version')}}"
