vacation_mode_package:
  input_boolean:
    vacation_mode_away:
      name: "Vakantie (weg)"
      icon: mdi:home-lock

  input_datetime:
    time_vacation_lights_start:
      name: Vakantie verlichting start
      has_time: true
    time_vacation_lights_end:
      name: Vakantie verlichting einde
      has_time: true

  automation:
    #############################
    ## Vakantie verlichting     #
    #############################
    - id: vacation_turn_on_time
      alias: "Zet de verlichting aan tijdens vakantie"
      initial_state: on
      triggers:
        - alias: Vakantie verlichting starttijd bereikt
          trigger: time
          at: input_datetime.time_vacation_lights_start
      conditions:
        - alias: Vakantie modus is ingeschakeld
          condition: state
          entity_id: input_boolean.vacation_mode_away
          state: "on"
      actions:
        - delay: "{{ range(30*60) | random }}"
          alias: "Willekeurige vertraging tussen nu en 30 minuten"
        - alias: Zet woonkamer- en eetkamerverlichting aan
          action: homeassistant.turn_on
          entity_id:
            - light.spots_woonkamer
            - light.spots_eetkamer
        - alias: Log inschakelmoment van vakantieverlichting
          action: logbook.log
          data:
            name: Vakantie
            message: Verlichting aan gezet om {{ now().strftime('%H:%M') }}.
            domain: light
        - alias: Stuur melding dat vakantieverlichting is ingeschakeld
          action: notify.mobile_app_sm_a556b
          data:
            message: Ik heb je vakantie verlichting aan gezet om {{ now().strftime('%H:%M') }}.
            title: Vakantie verlichting
            data:
              ttl: 0
              priority: high

    - id: vacation_turn_off_time
      alias: "Zet de verlichting uit tijdens vakantie"
      triggers:
        - alias: Vakantie verlichting eindtijd bereikt
          trigger: time
          at: input_datetime.time_vacation_lights_end
      conditions:
        - alias: Vakantie modus is ingeschakeld
          condition: state
          entity_id: input_boolean.vacation_mode_away
          state: "on"
      actions:
        - delay: "{{ range(15*60) | random }}"
          alias: "Willekeurige vertraging tussen nu en 15 minuten"
        - alias: Zet woonkamer- en eetkamerverlichting uit
          action: homeassistant.turn_off
          entity_id:
            - light.spots_woonkamer
            - light.spots_eetkamer
        - alias: Log uitschakelmoment van vakantieverlichting
          action: logbook.log
          data:
            name: Vakantie
            message: Verlichting uit gezet om {{ now().strftime('%H:%M') }}.
            domain: light
        - alias: Stuur melding dat vakantieverlichting is uitgeschakeld
          action: notify.mobile_app_sm_a556b
          data:
            message: Ik heb je verlichting uit gezet om {{ now().strftime('%H:%M') }}.
            title: Vakantie verlichting
            data:
              ttl: 0
              priority: high

    #############################
    ## Vakantie alarm           #
    #############################
    - id: vacation_movement_inside
      alias: "Beweging gedetecteerd tijdens vakantie"
      trigger:
        - alias: Beweging of contact gedetecteerd in huis
          platform: state
          entity_id:
            - binary_sensor.fietsenhok_contact
            - binary_sensor.pir_bijkeuken_occupancy
            - binary_sensor.pir_gang_kapstok_motion_detection
            - binary_sensor.pir_gang_meterkast_motion_detection
            - binary_sensor.pir_inloopkast_occupancy
            - binary_sensor.poort_contact
          from: "off"
          to: "on"
      condition:
        - alias: Vakantie modus is ingeschakeld
          condition: state
          entity_id: input_boolean.vacation_mode_away
          state: "on"
      action:
        - alias: Stuur melding bij beweging tijdens vakantie
          action: notify.mobile_app_sm_a556b
          data:
            message: >
              Er is beweging gedetecteerd door {{ trigger.from_state.attributes.friendly_name }} ({{ now().strftime('%H:%M') }})
            title: Beweging in huis
            data:
              ttl: 0
              priority: high
              notification_icon: "mdi:shield-home"
        - alias: Log gedetecteerde beweging tijdens vakantie
          action: logbook.log
          data:
            name: Vakantie
            message: Er is beweging gedetecteerd door {{ trigger.from_state.attributes.friendly_name }}.
            domain: binary_sensor
