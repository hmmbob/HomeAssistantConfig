wc_boven_package:
  automation:
    - id: lights_wc_boven
      alias: "Zet de verlichting van de WC boven aan of uit"
      mode: restart
      max_exceeded: silent
      triggers:
        - alias: Beweging gedetecteerd in toilet
          trigger: state
          entity_id: binary_sensor.pir_wc_boven_occupancy
          to: "on"
          from: "off"
          id: turn_on
        - alias: Geen beweging meer in toilet
          trigger: state
          entity_id: binary_sensor.pir_wc_boven_occupancy
          to: "off"
          from: "on"
          id: turn_off
      conditions: []
      actions:
        - alias: "Bepalen wat er moet gebeuren"
          choose:
            - alias: "Moeten we de verlichting inschakelen?"
              conditions:
                - alias: Verlichting moet worden ingeschakeld
                  condition: template
                  value_template: "{{ trigger.id == 'turn_on' }}"
              sequence:
                - alias: Schakel verlichting in op basis van tijd
                  if:
                    - alias: "Is het tijdens de donkere uren?"
                      condition: time
                      after: "22:30:00"
                      before: "06:45:00"
                  then:
                    - alias: "Lamp WC boven gedimd aan..."
                      action: light.turn_on
                      target:
                        entity_id: light.wc_boven
                      data:
                        brightness: 80
                  else:
                    - alias: "Lamp WC boven voluit aan..."
                      action: light.turn_on
                      target:
                        entity_id: light.wc_boven
                      data:
                        brightness: 255
            - alias: "Moeten we de verlichting uitschakelen?"
              conditions:
                - alias: Verlichting moet worden uitgeschakeld
                  condition: template
                  value_template: "{{ trigger.id == 'turn_off' }}"
              sequence:
                - alias: "Lamp WC boven uitzetten..."
                  action: light.turn_off
                  target:
                    entity_id: light.wc_boven
