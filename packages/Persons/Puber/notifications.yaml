puber_notifications_package:
  automation:
    ##########################
    ## Coming home notifications
    ##########################
    - id: notification_m_left_school
      alias: "Location: Notificatie dat M van school vertrekt"
      initial_state: on
      trigger:
        - platform: zone
          entity_id: device_tracker.schaduwspeler
          event: leave
          zone: zone.school
      condition:
        - condition: time
          after: "12:00:00"
          before: "18:00:00"
          weekday:
            - mon
            - tue
            - wed
            - thu
            - fri
      action:
        - service: notify.mobile_devices_adults
          data:
            title: â™¥ {{states('input_text.naam_puber')}} is op weg naar huis!
            message: >
              {{states('input_text.naam_puber')}} is rond {{now().strftime("%H:%M")}} van school vertrokken.
            data:
              actions:
                - action: "URI"
                  title: "Check huidige locatie"
                  uri: "/lovelace-map/0"
              ttl: 0
              priority: high
              icon_url: "https://raw.githubusercontent.com/home-assistant/assets/master/logo/logo-pretty.png"
        - service: notify.mobile_app_schaduwspeler
          data:
            title: Goede thuisreis
            message: "Ik heb thuis laten weten dat je onderweg bent."
            data:
              ttl: 0
              priority: high
              icon_url: "https://raw.githubusercontent.com/home-assistant/assets/master/logo/logo-pretty.png"

    ##########################
    ## Battery level notifications
    ##########################
    - id: notification_m_battery_low_parents
      alias: "Notifications: Melding dat batterij van M bijna leeg is"
      initial_state: on
      trigger:
        - platform: numeric_state
          entity_id: sensor.schaduwspeler_batterijniveau
          below: 10
      condition:
        not:
          - condition: state
            entity_id: device_tracker.schaduwspeler
            state: home
      action:
        - service: notify.mobile_devices_adults
          data:
            title: ðŸ”‹ Batterijwaarschuwing
            message: >
              De telefoon van {{states('input_text.naam_puber')}} is bijna leeg. Updates van zijn locatie zullen snel stoppen.
            data:
              ttl: 0
              priority: high
              icon_url: "https://raw.githubusercontent.com/home-assistant/assets/master/logo/logo-pretty.png"
              notification_icon: mdi:battery-alert-variant
        - service: notify.mobile_app_schaduwspeler
          data:
            title: ðŸ”‹ Batterijwaarschuwing
            message: >
              Je moet je telefoon even opladen....
            data:
              ttl: 0
              priority: high
              icon_url: "https://raw.githubusercontent.com/home-assistant/assets/master/logo/logo-pretty.png"
              notification_icon: mdi:battery-alert-variant
