lights_livingroom_package:
  group:
    lampen_woonkamer:
      name: Verlichting Woonkamer
      icon: mdi:lamps
      entities:
        - switch.grijze_lamp
        - switch.kast
        - switch.staande_lamp
        - switch.tv_kastje
        - switch.zoutlamp
        - light.window_level

  input_boolean:
    enable_pir_woonkamer_automations:
      name: "Verlichting woonkamer aan op beweging"
      icon: mdi:motion-sensor
    woonkamer_turned_on_by_movement:
      name: "Woonkamer aan gedaan via PIR"
      icon: mdi:lightbulb-on-outline

  scene:
    - name: "Alles uit"
      id: allesuit
      entities:
        light.eetkamer_level: "off"
        switch.grijze_lamp: "off"
        switch.staande_lamp: "off"
        switch.window: "off"

    - name: Avond
      id: avond
      entities:
        switch.grijze_lamp: "on"
        switch.staande_lamp: "on"
        switch.window: "on"

  automation:
    ##########################
    ## Woonkamer aan op beweging
    ##########################
    - id: turn_on_woonkamer_on_movement
      alias: "Lights: Woonkamer aan op beweging"
      trigger:
        platform: state
        entity_id: binary_sensor.pir_woonkamer_motion
        to: "on"
      condition:
        and:
          - condition: time
            after: "06:15:00"
            before: "08:10:00"
          - condition: state
            entity_id: input_boolean.enable_pir_woonkamer_automations
            state: "on"
          - condition: state
            entity_id:
              - group.lampen_woonkamer
              - input_boolean.woonkamer_turned_on_by_movement
              - light.eetkamer_level
            state: "off"
          - condition: numeric_state
            entity_id: sun.sun
            attribute: elevation
            below: 8
      action:
        - service: homeassistant.turn_on
          entity_id:
            - switch.grijze_lamp
            - input_boolean.woonkamer_turned_on_by_movement

    ##########################
    ## Verlichting woonkamer uit op schooltijd
    ##########################
    - id: turn_off_woonkamer_30min_after_movement
      alias: "Lights: Woonkamer uit na 30min"
      trigger:
        - platform: state
          entity_id: binary_sensor.pir_woonkamer_motion
          to: "off"
          for:
            minutes: 30
        - platform: time
          at: input_datetime.time_schooltijd
      condition:
        and:
          - condition: state
            entity_id:
              - binary_sensor.schooldag
              - input_boolean.woonkamer_turned_on_by_movement
            state: "on"
          - condition: state
            entity_id: input_boolean.vacation_mode_home
            state: "off"
      action:
        - service: homeassistant.turn_off
          entity_id:
            - group.lampen_woonkamer
            - input_boolean.woonkamer_turned_on_by_movement

    # Turn off helper if we manually turned off the lights
    - id: turn_off_woonkamer_input_boolean
      alias: "Lights: Woonkamer turn off input_boolean"
      trigger:
        - platform: time
          at: "09:00:00"
      condition:
        - condition: state
          entity_id: input_boolean.woonkamer_turned_on_by_movement
          state: "on"
      action:
        - service: homeassistant.turn_off
          entity_id:
            - input_boolean.woonkamer_turned_on_by_movement

    ##########################
    ## Sunset lights woonkamer
    ##########################
    - id: set_lights_before_sunset
      alias: "Lights: Sunset set lights"
      trigger:
        platform: sun
        event: sunset
        offset: "-00:15:00"
      condition:
        and:
          - condition: state
            entity_id: input_boolean.enable_pir_woonkamer_automations
            state: "on"
          - condition: state
            entity_id: group.all_adults
            state: home
          - condition: state
            entity_id: group.lampen_woonkamer
            state: "off"
      action:
        - service: homeassistant.turn_on
          entity_id:
            - switch.grijze_lamp
            - switch.kast
            - switch.tv_kastje
