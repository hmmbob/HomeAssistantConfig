lights_garden_package:
  sensor:
    - platform: schedule_state
      name: Garden lights
      default_state: "off"
      events:
        - start: "6:30"
          end: "{{ as_timestamp(state_attr('sun.sun', 'next_rising')) }}"
          state: "on"
          condition:
            condition: sun
            before: sunrise
        - start: "{{ as_timestamp(state_attr('sun.sun', 'next_setting')) }}"
          end: "22:30"
          state: "on"

  automation:
    - id: garden_turn_on
      alias: "Lights: Garden turn on"
      trigger:
        - platform: state
          entity_id: sensor.garden_lights
        - platform: state
          entity_id: light.tuinverlichting
          from: unavailable
        - platform: homeassistant
          event: start
        - platform: event
          event_type: automation_reloaded
      condition:
        - alias: "Do we have a valid state"
          condition: template
          value_template: "{{ states('sensor.garden_lights') not in ['unknown','unavailable','none'] }}"
      action:
        - service: light.turn_{{ states('sensor.garden_lights') }}
          target:
            entity_id: light.tuinverlichting
