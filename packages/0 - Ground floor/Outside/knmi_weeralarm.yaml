knmi_weeralarm_package:
  rest:
    - resource: https://cdn.knmi.nl/knmi/xml/rss/rss_KNMIwaarschuwingen.xml
      scan_interval: 900
      sensor:
        - name: "KNMI All data"
          value_template: "OK"
          json_attributes_path: "$.rss.channel"
          json_attributes:
            - "item"
          force_update: true

  template:
    - sensor:
        - name: "KNMI Weeralarm Noord-Brabant"
          unique_id: knmi_weeralarm_brabant
          state: >-
            {{ (state_attr('sensor.knmi_all_data', 'item')
                  | selectattr('title', 'search', 'Waarschuwingen Noord-Brabant')
                  | map(attribute='description')
                  | join).split('.')[0]
            }}
          attributes:
            warning: >-
              {{ ((state_attr('sensor.knmi_all_data', 'item')
                  | selectattr('title', 'search', 'Waarschuwingen Noord-Brabant')
                  | map(attribute='description')
                  | join).split('<br>') | join('.')).split('.') 
                  | select() | list | reject('search', 'Code|Wat kan ik') 
                  | join('. ') | striptags | trim }}
