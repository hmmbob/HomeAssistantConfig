trash_package:
  sensor:
    - platform: afvalinfo
      resources:
        - gft
        - papier
        - pbd
        - restafval
        - trash_type_today
        - trash_type_tomorrow
      location: !secret afvalinfo_location
      postcode: !secret afvalinfo_postcode
      streetnumber: !secret afvalinfo_streetnumber
      locale: "nl"

  input_boolean:
    notify_trash:
      name: "Push-meldingen over afval"
      icon: mdi:message-bulleted
    notify_trash_voice:
      name: "Voice-meldingen over afval"
      icon: mdi:account-voice

  input_datetime:
    time_trash_warning_today:
      name: Melding afval vandaag
      has_time: true
    time_trash_warning_tomorrow:
      name: Melding afval morgen
      has_time: true

  input_text:
    trash_url_gft:
      name: Trash URL GFT
      initial: !secret image_url_gft

    trash_url_papier:
      name: Trash URL papier
      initial: !secret image_url_oudpapier

    trash_url_pbd:
      name: Trash URL plastic
      initial: !secret image_url_plastic

    trash_url_pbdpapier:
      name: Trash URL plastic en papier
      initial: !secret image_url_plasticpapier
    trash_url_papierpbd:
      name: Trash URL papier en plastic
      initial: !secret image_url_plasticpapier

    trash_url_restafval:
      name: Trash URL restafval
      initial: !secret image_url_restafval

  automation:
    ##########################
    ## Trash notifications
    ##########################
    - alias: "Afval: Meldingen"
      id: melding_afval
      trigger:
        - platform: time
          at: input_datetime.time_trash_warning_today
          id: vandaag
        - platform: time
          at: input_datetime.time_trash_warning_tomorrow
          id: morgen
      variables:
        sensor: "sensor.afvalinfo_{{ trigger.id }}"
        trash_descr:
          pbd: "plastic"
          gft: "GFT"
          restafval: "restafval"
          papier: "oud papier"
          "pbd, papier": "plastic en oud papier"
          "papier, pbd": "plastic en oud papier"
        afval: >
          {{ trash_descr.get(states(sensor), "onbekend") }}
      condition:
        - alias: "Do we want notifications?"
          condition: state
          entity_id: input_boolean.notify_trash
          state: "on"
        - alias: "Do we need to send a notification"
          condition: template
          value_template: "{{ states(sensor) not in ['unknown','unavailable','none'] }}"
      action:
        - alias: "Sending push notification"
          service: notify.mobile_app_sm_a526b
          data:
            title: "Afvalinzameling"
            message: "{{ trigger.id | capitalize }} wordt het {{ afval }} opgehaald."
            data:
              tag: "notification-trash"
              icon_url: "https://raw.githubusercontent.com/home-assistant/assets/master/logo/logo-pretty.png"
              notification_icon: mdi:delete
        - alias: "Check if TTS should be played"
          condition: state
          entity_id: input_boolean.notify_trash_voice
          state: "on"
        - alias: "Play TTS"
          service: tts.microsoft_say
          entity_id: media_player.nest_hub_woonkamer
          data:
            message: "{{ trigger.id }} wordt het {{ afval }} opgehaald."
        - delay: "00:00:15"
        - alias: "Streaming image to Nest Hub"
          service: media_player.play_media
          data:
            entity_id: media_player.nest_hub_woonkamer
            media_content_id: "{{ states('input_text.trash_url_' ~ states(sensor).replace(' ', '')) }}"
            media_content_type: "image/png"
        - delay: "00:15:00"
        - service: media_player.turn_off
          entity_id: media_player.nest_hub_woonkamer
