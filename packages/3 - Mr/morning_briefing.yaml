morning_briefing_package:
  ##########################
  ## Sends a morning briefing message to my phone
  ##########################
  input_datetime:
    time_morning_briefing:
      name: Start morning briefing
      has_time: true

  automation:
    - id: morning_briefing
      alias: "Verstuur ochtendbriefing"
      description: "Notifications: Morning briefing"
      triggers:
        alias: Trigger op de ingestelde tijd
        trigger: time
        at: input_datetime.time_morning_briefing
      conditions:
        - alias: Voorwaarde vakantiemodus afwezig is uit
          condition: state
          entity_id: input_boolean.vacation_mode_away
          state: "off"
      actions:
        - alias: Genereer ochtendbriefing
          action: ai_task.generate_data
          response_variable: response
          data:
            entity_id: ai_task.google_ai_task_gemini_3_flash_preview
            task_name: Ochtendbriefing
            instructions: |
              Write a concise and friendly morning briefing in Dutch (plain text only, no markdown, no bold, no headers) that includes:
              - The time the sun rises today: {{ states('sensor.sun_next_rising') | as_datetime | as_timestamp | timestamp_custom('%H:%M', True) }}
              - The maximum temperature expected today: {{ states('sensor.knmi_max_temperatuur_vandaag', with_unit=True)}}
              - The current outdoor temperature and weather description: {{ states('sensor.knmi_temperatuur', with_unit=True) }} and {{ states('sensor.knmi_omschrijving') | lower}}
              - A brief weather forecast for today: {{ states('sensor.knmi_weersverwachting') }}
        - alias: Stuur ochtendmelding
          action: notify.mobile_app_sm_a556b
          data:
            title: Good morning sunshine!
            message: "{{ response.data }}"
            data:
              tag: "morning-brief"
              notification_icon: mdi:weather-sunset-up
